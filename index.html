<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=10, user-scalable=yes" />
  <title>CyberPumpkin Map (Canvas)</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background-color: #0a0a0a;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: #fff;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    #info-bar {
      background-color: #1a1a1a;
      padding: 15px 20px;
      border-bottom: 2px solid #ff00cc;
      z-index: 10;
    }

    #info-bar h2 {
      color: #ff00cc;
      font-size: 1.2rem;
      margin: 0;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    #info-bar p {
      margin-top: 4px;
      font-size: 0.95rem;
      color: #ccc;
    }

    #game-canvas {
      flex-grow: 1;
      display: block;
      width: 100%;
    }

    canvas {
      display: block;
      width: 100% !important;
      height: 100% !important;
    }
  </style>
</head>
<body>
  <div id="info-bar">
    <h2 id="zone-name">Tap a Zone</h2>
    <p id="zone-description">Select an area to view its description.</p>
  </div>
  <div id="game-canvas"></div>

  <script src="https://cdn.jsdelivr.net/npm/pixi.js@7.x/dist/pixi.min.js"></script>
  <script>
    const app = new PIXI.Application({
      resizeTo: window,
      backgroundColor: 0x0a0a0a,
      antialias: true
    });
    document.getElementById('game-canvas').appendChild(app.view);

    const zoneData = {
      watson: {
        name: "Watson",
        description: "A formerly prosperous corporate zone, now full of immigrants, fixers, and gang activity."
      },
      pacifica: {
        name: "Pacifica",
        description: "Originally a luxury development project, now largely abandoned and ruled by the Voodoo Boys."
      },
      "city-center": {
        name: "City Center",
        description: "The corporate heart of Night City, filled with megatowers, high-end security, and executive dealings."
      }
    };

    const zoneName = document.getElementById("zone-name");
    const zoneDesc = document.getElementById("zone-description");

    // Load the map image
    PIXI.Assets.add('map', 'night-city-map.jpg');
    PIXI.Assets.load('map').then((texture) => {
      const container = new PIXI.Container();
      app.stage.addChild(container);

      const map = new PIXI.Sprite(texture);
      container.addChild(map);

      map.anchor.set(0);
      map.x = 0;
      map.y = 0;

      container.scale.set(1);
      container.interactive = true;
      container.interactiveChildren = true;

      // Create tappable hit areas (you can adjust coords later)
      const makeZone = (id, points, color = 0xff00cc) => {
        const zone = new PIXI.Graphics();
        zone.lineStyle(2, color);
        zone.beginFill(color, 0.1);
        zone.drawPolygon(points);
        zone.endFill();
        zone.eventMode = 'static';
        zone.cursor = 'pointer';
        zone.on('pointertap', () => {
          const data = zoneData[id];
          if (data) {
            zoneName.textContent = data.name;
            zoneDesc.textContent = data.description;
          }
        });
        container.addChild(zone);
      };

      // Sample rough polygon zones (replace with accurate coords later)
      makeZone("watson", [200, 100, 350, 120, 330, 250, 210, 230]);
      makeZone("pacifica", [700, 400, 850, 380, 830, 520, 710, 510]);
      makeZone("city-center", [450, 150, 600, 140, 620, 300, 460, 310]);

      // Add zoom/pan
      let dragging = false;
      let lastPos = null;
      let scale = 1;

      app.view.addEventListener("wheel", (e) => {
        const direction = e.deltaY > 0 ? -1 : 1;
        const factor = 0.1;
        const newScale = Math.min(Math.max(0.5, scale + direction * factor), 5);
        const mousePos = app.renderer.plugins.interaction.mouse.global;

        const worldPos = {
          x: (mousePos.x - container.x) / container.scale.x,
          y: (mousePos.y - container.y) / container.scale.y,
        };

        container.scale.set(newScale);
        container.x = mousePos.x - worldPos.x * newScale;
        container.y = mousePos.y - worldPos.y * newScale;
        scale = newScale;
      });

      app.view.addEventListener("pointerdown", (e) => {
        dragging = true;
        lastPos = { x: e.clientX, y: e.clientY };
      });

      app.view.addEventListener("pointermove", (e) => {
        if (!dragging) return;
        const dx = e.clientX - lastPos.x;
        const dy = e.clientY - lastPos.y;
        container.x += dx;
        container.y += dy;
        lastPos = { x: e.clientX, y: e.clientY };
      });

      app.view.addEventListener("pointerup", () => dragging = false);
      app.view.addEventListener("pointerupoutside", () => dragging = false);
    });
  </script>
</body>
</html>
